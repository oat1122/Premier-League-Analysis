import streamlit as st
import joblib
import numpy as np

# ‡πÇ‡∏´‡∏•‡∏î‡πÇ‡∏°‡πÄ‡∏î‡∏•‡∏ó‡∏µ‡πà‡∏ù‡∏∂‡∏Å‡∏°‡∏≤‡πÅ‡∏•‡πâ‡∏ß
clf = joblib.load('./model/xg_modeltest.pkl')  # ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÇ‡∏´‡∏•‡∏î label encoder ‡πÅ‡∏•‡πâ‡∏ß

# ‡∏™‡πà‡∏ß‡∏ô‡∏´‡∏±‡∏ß‡∏Ç‡∏≠‡∏á‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö
st.set_page_config(page_title="xG Football Predictor", page_icon="‚öΩ")
st.title("‚öΩ Football Match Result Predictor")
st.markdown("‡∏ó‡∏≥‡∏ô‡∏≤‡∏¢‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô‡∏à‡∏≤‡∏Å‡∏Ñ‡πà‡∏≤ Expected Goals (xG) ‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ‡πÇ‡∏°‡πÄ‡∏î‡∏• Machine Learning")

# ‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
st.subheader("üì• ‡∏õ‡πâ‡∏≠‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô")

home_team = st.text_input("üè† ‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡∏°‡πÄ‡∏´‡∏¢‡πâ‡∏≤", "")
away_team = st.text_input("üõ´ ‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡∏°‡πÄ‡∏¢‡∏∑‡∏≠‡∏ô", "")
home_xg = st.number_input("üî¢ ‡∏Ñ‡πà‡∏≤ homeXG (‡πÇ‡∏≠‡∏Å‡∏≤‡∏™‡∏ó‡∏≥‡∏õ‡∏£‡∏∞‡∏ï‡∏π‡πÄ‡∏à‡πâ‡∏≤‡∏ö‡πâ‡∏≤‡∏ô)", min_value=0.0, step=0.1, format="%.2f")
away_xg = st.number_input("üî¢ ‡∏Ñ‡πà‡∏≤ awayXG (‡πÇ‡∏≠‡∏Å‡∏≤‡∏™‡∏ó‡∏≥‡∏õ‡∏£‡∏∞‡∏ï‡∏π‡∏ó‡∏µ‡∏°‡πÄ‡∏¢‡∏∑‡∏≠‡∏ô)", min_value=0.0, step=0.1, format="%.2f")

# ‡πÄ‡∏°‡∏õ‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏Ñ‡∏≤‡∏î‡∏Å‡∏≤‡∏£‡∏ì‡πå‡πÄ‡∏õ‡πá‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°
result_map = {
    'H': 'üè† ‡∏ó‡∏µ‡∏°‡πÄ‡∏´‡∏¢‡πâ‡∏≤‡∏ä‡∏ô‡∏∞',
    'A': 'üõ´ ‡∏ó‡∏µ‡∏°‡πÄ‡∏¢‡∏∑‡∏≠‡∏ô‡∏ä‡∏ô‡∏∞',
    'D': 'ü§ù ‡πÄ‡∏™‡∏°‡∏≠‡∏Å‡∏±‡∏ô'
}

# ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°
if st.button("üîç ‡∏ó‡∏≥‡∏ô‡∏≤‡∏¢‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô"):
    if not home_team or not away_team:
        st.warning("‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡∏°‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏≠‡∏á‡∏ó‡∏µ‡∏°")
    else:
        xg_diff = home_xg - away_xg
        input_data = np.array([[home_xg, away_xg, xg_diff]])
        prediction = clf.predict(input_data)
        result = prediction[0]  # ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ le.inverse_transform ‡πÅ‡∏•‡πâ‡∏ß
        result_text = result_map.get(result, "‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡πÑ‡∏°‡πà‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô")

        st.success(f"üîÆ ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á **{home_team}** vs **{away_team}**")
        st.markdown(f"### üëâ ‡∏ú‡∏•‡∏ó‡∏µ‡πà‡∏Ñ‡∏≤‡∏î‡∏Å‡∏≤‡∏£‡∏ì‡πå: **{result_text}**")

        # ‡πÄ‡∏≠‡∏ü‡πÄ‡∏ü‡∏Å‡∏ï‡πå‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•
        if result == "H":
            st.balloons()
        elif result == "A":
            st.snow()
        else:
            st.info("‡πÄ‡∏Å‡∏°‡∏ó‡∏µ‡πà‡∏™‡∏π‡∏™‡∏µ‡∏Å‡∏±‡∏ô‡∏°‡∏≤‡∏Å! ü§ù")
